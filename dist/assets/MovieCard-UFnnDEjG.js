var S=s=>{throw TypeError(s)};var E=(s,e,t)=>e.has(s)||S("Cannot "+t);var r=(s,e,t)=>(E(s,e,"read from private field"),t?t.call(s):e.get(s)),f=(s,e,t)=>e.has(s)?S("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),j=(s,e,t,i)=>(E(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),y=(s,e,t)=>(E(s,e,"access private method"),t);import{j as a,r as x,u as F,D as U,e as K,i as M,L as D,E as L,F as q}from"./index-DNg-2o6Y.js";import{S as B,s as P,h as N,g as $,n as k,a as A,b as I,c as Q,q as T}from"./Message-DyVdwm-v.js";const G="_none_13pvz_81",n={"movie-card":"_movie-card_13pvz_1","movie-card__link":"_movie-card__link_13pvz_9","movie-card__remove":"_movie-card__remove_13pvz_27","movie-card__picture":"_movie-card__picture_13pvz_31","movie-card__picture-img":"_movie-card__picture-img_13pvz_39","movie-card__picture-wrapper":"_movie-card__picture-wrapper_13pvz_44","movie-card__title":"_movie-card__title_13pvz_51","movie-card__title-wrapper":"_movie-card__title-wrapper_13pvz_54","movie-card__place":"_movie-card__place_13pvz_61",none:G},H="_place_fvme2_1",J="_place__text_fvme2_15",z={place:H,place__text:J},V=({place:s})=>a.jsx("div",{className:z.place,children:s&&a.jsx("span",{className:z.place__text,children:s})});var m,p,o,u,_,C,O,R,W=(R=class extends B{constructor(e,t){super();f(this,_);f(this,m);f(this,p);f(this,o);f(this,u);j(this,m,e),this.setOptions(t),this.bindMethods(),y(this,_,C).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const t=this.options;this.options=r(this,m).defaultMutationOptions(e),P(this.options,t)||r(this,m).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,o),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&N(t.mutationKey)!==N(this.options.mutationKey)?this.reset():((i=r(this,o))==null?void 0:i.state.status)==="pending"&&r(this,o).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=r(this,o))==null||e.removeObserver(this)}onMutationUpdate(e){y(this,_,C).call(this),y(this,_,O).call(this,e)}getCurrentResult(){return r(this,p)}reset(){var e;(e=r(this,o))==null||e.removeObserver(this),j(this,o,void 0),y(this,_,C).call(this),y(this,_,O).call(this)}mutate(e,t){var i;return j(this,u,t),(i=r(this,o))==null||i.removeObserver(this),j(this,o,r(this,m).getMutationCache().build(r(this,m),this.options)),r(this,o).addObserver(this),r(this,o).execute(e)}},m=new WeakMap,p=new WeakMap,o=new WeakMap,u=new WeakMap,_=new WeakSet,C=function(){var t;const e=((t=r(this,o))==null?void 0:t.state)??$();j(this,p,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},O=function(e){k.batch(()=>{var t,i,c,v,h,l,g,b;if(r(this,u)&&this.hasListeners()){const d=r(this,p).variables,w=r(this,p).context;(e==null?void 0:e.type)==="success"?((i=(t=r(this,u)).onSuccess)==null||i.call(t,e.data,d,w),(v=(c=r(this,u)).onSettled)==null||v.call(c,e.data,null,d,w)):(e==null?void 0:e.type)==="error"&&((l=(h=r(this,u)).onError)==null||l.call(h,e.error,d,w),(b=(g=r(this,u)).onSettled)==null||b.call(g,void 0,e.error,d,w))}this.listeners.forEach(d=>{d(r(this,p))})})},R);function X(s,e){const t=A(e),[i]=x.useState(()=>new W(t,s));x.useEffect(()=>{i.setOptions(s)},[i,s]);const c=x.useSyncExternalStore(x.useCallback(h=>i.subscribe(k.batchCalls(h)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),v=x.useCallback((h,l)=>{i.mutate(h,l).catch(I)},[i]);if(c.error&&Q(i.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:v,mutateAsync:c.mutate}}const te=({movie:s,isBtnRemoveFavorite:e,place:t,className:i,handlers:c})=>{const v=F(),{isSuccess:h,error:l,mutate:g}=X({mutationFn:q},T),b=s.posterUrl||U;x.useEffect(()=>{c&&c.clickBtnRemoveFavorite&&c.clickBtnRemoveFavorite(s.id)},[h]),x.useEffect(()=>{l&&v(K.add([l.message]))},[l,v]);const d=()=>{g(s.id)};return a.jsxs("div",{className:M(n["movie-card"],{[`${i}`]:i}),children:[a.jsx(D,{className:n["movie-card__link"],to:`/movie/${s.id}`}),e&&a.jsx("div",{className:M(n["movie-card__remove"]),children:a.jsx(L,{type:"button",onClick:d})}),a.jsx("div",{className:n["movie-card__picture-wrapper"],children:a.jsxs("picture",{className:n["movie-card__picture"],children:[a.jsx("source",{className:n["movie-card__picture-source"],srcSet:b,media:"(max-width: 1920px)"}),a.jsx("source",{className:n["movie-card__picture-source"],srcSet:b,media:"(min-width: 1920px)"}),a.jsx("img",{className:n["movie-card__picture-img"],src:b,alt:"Постер"})]})}),!s.posterUrl&&a.jsx("div",{className:n["movie-card__title-wrapper"],children:a.jsx("h2",{className:n["movie-card__title"],children:s.title})}),t&&a.jsx("div",{className:M(n["movie-card__place"]),children:a.jsx(V,{place:t})})]})};export{te as M};
